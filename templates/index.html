<!DOCTYPE html>
<html>
<head>
    <title>Image Caption Generator</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <script>
        function previewImage(event) {
            // X√≥a k·∫øt qu·∫£ c≈©
            const resultDiv = document.getElementById('resultDiv');
            if (resultDiv) {
                resultDiv.style.display = 'none';
            }
            
            // X√≥a ·∫£nh server-side c≈©
            const serverImage = document.getElementById('serverImage');
            if (serverImage) {
                serverImage.style.display = 'none';
            }
            
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('imageContainer').style.display = 'block';
                    document.getElementById('predictBtn').style.display = 'inline-block';
                }
                reader.readAsDataURL(file);
            } else {
                document.getElementById('imageContainer').style.display = 'none';
            }
        }
        
        function showLoading() {
            document.getElementById('loadingDiv').style.display = 'block';
            document.getElementById('predictBtn').style.display = 'none';
        }
    </script>
</head>
<body>
    <h1>üñºÔ∏è Image Caption Generator</h1>
    
    <div class="upload-container">
        <form method="POST" enctype="multipart/form-data" onsubmit="showLoading()">
            <label for="image" class="upload-label">üìÅ Ch·ªçn ·∫£nh t·ª´ th∆∞ m·ª•c:</label>
            <input type="file" name="image" id="image" class="file-input" accept="image/*" onchange="previewImage(event)" required>
            
            <!-- Preview ·∫£nh m·ªõi ch·ªçn -->
            <div id="imageContainer" class="image-preview" style="display: none;">
                <img id="imagePreview" alt="Preview">
                <br>
                <button type="submit" name="predict" id="predictBtn" style="display: none;">ü§ñ Predict Caption</button>
                
                <div id="loadingDiv" class="loading">
                    <div class="spinner"></div>
                    ƒêang ph√¢n t√≠ch ·∫£nh...
                </div>
            </div>
        </form>
    </div>
    
    <!-- ·∫¢nh t·ª´ server (sau khi predict) -->
    {% if image_base64 %}
    <div id="serverImage" class="image-preview">
        <img src="data:image/jpeg;base64,{{ image_base64 }}" alt="Uploaded Image">
    </div>
    {% endif %}
    
    <!-- K·∫øt qu·∫£ caption -->
    {% if response %}
    <div id="resultDiv" class="result">
        <h3>üìù Caption ƒë∆∞·ª£c t·∫°o:</h3>
        <p>{{ response }}</p>
    </div>
    {% endif %}
</body>
</html>